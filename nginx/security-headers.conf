# Security Headers Configuration for n8n
# Prevents CORS issues while maintaining OAuth functionality

# Basic Security Headers
add_header X-Frame-Options "DENY" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header X-Robots-Tag "noindex, nofollow" always;

# Permissions Policy (limit browser APIs)
add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), speaker=(), fullscreen=(self), sync-xhr=()" always;

# Content Security Policy - allows OAuth but blocks telemetry
# This prevents localhost:5678 requests while allowing legitimate OAuth callbacks
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' data:; img-src 'self' data: https:; connect-src 'self' https://api.github.com https://github.com https://slack.com https://hooks.slack.com https://api.linear.app https://linear.app https://api.notion.com https://notion.so; font-src 'self' data:; object-src 'none'; media-src 'self'; frame-src 'none'; worker-src 'self' blob:; child-src 'self' blob:;" always;

# Security Headers for static assets
add_header Cache-Control "public, max-age=31536000, immutable" always;

# Remove server information
server_tokens off;